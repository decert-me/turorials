const fs = require('fs');
const path = require('path');

const DOCS_DIR = path.join(__dirname, 'docs');

const getSidebars = (dir, sidebars = {}) => {
    const files = fs.readdirSync(dir);
    files.forEach((file) => {
        sidebars[file] = [
            {
                type: "autogenerated",
                dirName: file
            }
        ]
    });
    return sidebars;
};

function readJsonFile(filePath) {
    return new Promise((resolve, reject) => {
      fs.readFile(filePath, 'utf8', (err, data) => {
        if (err) {
          reject(err);
          return;
        }
        try {
          const jsonData = JSON.parse(data);
          resolve(jsonData);
        } catch (e) {
          reject(e);
        }
      });
    });
  }

const getNavbarItems = async(dir, navbarItems = []) => {
    const files = fs.readdirSync(dir);
    const tutorials = await readJsonFile("tutorials.json");
    // 初始化
    navbarItems.push({
        href: 'https://github.com/decert-me/learnsolidity',
        label: 'GitHub',
        position: 'right',
    })
    files.forEach((file, index) => {
        navbarItems.push({
            type: 'doc',
            docId: file+"/"+tutorials[index].startPage,
            position: 'left',
            label: tutorials[index].label,
        },)
    });
    return navbarItems;
};

const sidebar = getSidebars(DOCS_DIR);

// 侧边栏
fs.writeFileSync(
  path.join(__dirname, 'sidebars.js'),
  `module.exports = ${JSON.stringify(sidebar, null, 2)};`
);

async function generateNavbarItemsFile() {
    const navbarItems = await getNavbarItems(DOCS_DIR);
    fs.writeFileSync(
      path.join(__dirname, 'navbarItems.js'),
      `module.exports = ${JSON.stringify(navbarItems, null, 2)};`
    );
}
generateNavbarItemsFile(); // 执行函数